<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>StoryCall v2 – Realtime “FaceTime Replacement” (Santa)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#070b14;
      --ink:#fff;
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.55);
      --brand:#1565C0;
      --good:#2E7D32;
      --warn:#C62828;
      --border: rgba(255,255,255,.10);
      --shadow: 0 12px 28px rgba(0,0,0,.28);
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 50% 10%, rgba(21,101,192,.18), rgba(11,18,32,1));
      color: var(--ink);
      min-height:100vh;
    }
    header{
      max-width:1200px; margin:0 auto; padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:1000;}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: linear-gradient(135deg, #C62828, #ff7a7a);
      box-shadow: 0 12px 24px rgba(198,40,40,.25);
      display:flex;align-items:center;justify-content:center;
      font-weight:1000;
    }
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size:12px; font-weight:900;
    }

    main{max-width:1200px; margin:10px auto 60px; padding:0 16px; display:grid; grid-template-columns: 1.25fr .75fr; gap:16px;}
    @media (max-width: 980px){ main{grid-template-columns:1fr;} }

    .card{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      padding: 14px;
      box-shadow: var(--shadow);
    }
    .title{margin:0; font-size:16px; font-weight:1000;}
    .sub{margin:6px 0 0; color: var(--muted); font-weight:850; font-size:12px; line-height:1.35;}

    /* “Video call” stage */
    .stage{
      border-radius: 28px;
      background: var(--panel);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 760px;
      position:relative;
    }
    .topbar{
      padding: 14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .who{font-weight:1000;}
    .status{color: rgba(255,255,255,.72); font-weight:900; font-size:12px;}
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color:white;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight:1000;
      cursor:pointer;
    }
    .btn.good{background: var(--good); border-color: rgba(46,125,50,.4);}
    .btn.warn{background: var(--warn); border-color: rgba(198,40,40,.45);}
    .btn.primary{background: var(--brand); border-color: rgba(21,101,192,.45);}

    .videoArea{
      position:relative;
      padding: 16px;
      height: 520px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .santaFrame{
      width: min(520px, 92%);
      aspect-ratio: 1 / 1;
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,.10);
      background: radial-gradient(700px 380px at 50% 20%, rgba(198,40,40,.20), rgba(0,0,0,.15));
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .label{
      position:absolute;
      bottom: 12px;
      left: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      font-weight:950;
      font-size:12px;
      color: rgba(255,255,255,.85);
    }

    /* Self preview */
    video#selfPreview{
      position:absolute;
      right: 22px;
      bottom: 22px;
      width: 160px;
      height: 210px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      object-fit: cover;
      background: rgba(255,255,255,.06);
      box-shadow: 0 18px 28px rgba(0,0,0,.35);
      display:none;
    }
    .selfLabel{
      position:absolute; right: 32px; bottom: 236px;
      padding: 6px 10px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      font-weight:950; font-size:12px; color: rgba(255,255,255,.85);
      display:none;
    }

    /* Santa SVG */
    .santaSvg{width: min(380px, 88%); height:auto; filter: drop-shadow(0 14px 22px rgba(0,0,0,.35));}
    .bob{animation: bob 3s ease-in-out infinite;}
    @keyframes bob{0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)}}
    .talk .beard{animation: beardWiggle .22s infinite;}
    @keyframes beardWiggle{0%{transform:translateY(0)} 50%{transform:translateY(1px)} 100%{transform:translateY(0)}}
    .talk .mouth{animation: mouthTalk .18s infinite;}
    @keyframes mouthTalk{0%{transform:scaleY(1)} 50%{transform:scaleY(.6)} 100%{transform:scaleY(1)}}

    .controls{
      padding: 14px 16px 18px;
      display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap;
      border-top: 1px solid rgba(255,255,255,.08);
    }

    /* Transcript */
    .log{
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      padding: 12px;
      max-height: 300px;
      overflow:auto;
      display:flex; flex-direction:column; gap:10px;
    }
    .row{display:flex; gap:10px; align-items:flex-start;}
    .bubble{
      padding: 10px 12px;
      border-radius: 16px;
      max-width: 90%;
      font-weight:850;
      font-size:14px;
      line-height:1.35;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      white-space: pre-wrap;
    }
    .santa .bubble{background: rgba(198,40,40,.16); border-color: rgba(198,40,40,.22);}
    .kid{justify-content:flex-end;}
    .kid .bubble{background: rgba(21,101,192,.18); border-color: rgba(21,101,192,.25);}

    .tag{font-size:11px; font-weight:950; color: rgba(255,255,255,.75); margin-top:6px;}

    .small{font-size:12px; color: var(--muted); font-weight:850; line-height:1.35;}
    .stack{display:flex; flex-direction:column; gap:10px;}
    .choiceRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    input{
      width:100%;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:white;
      font-weight:850;
      outline:none;
    }
    input::placeholder{color: rgba(255,255,255,.55);}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">SC</div>
    <div>
      <div style="font-size:14px;">StoryCall</div>
      <div style="font-size:12px; color: rgba(255,255,255,.75); font-weight:850;">v2 Realtime WebRTC (Santa)</div>
    </div>
  </div>
  <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
    <span class="pill">Realtime WebRTC</span>
    <span class="pill">Speech-to-Speech</span>
    <span class="pill">Backchanneling</span>
  </div>
</header>

<main>
  <section class="stage">
    <div class="topbar">
      <div>
        <div class="who">Santa Claus</div>
        <div class="status" id="callStatus">Not connected</div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" id="camBtn">Camera Off</button>
        <button class="btn" id="pttBtn">Push-to-Talk Off</button>
        <button class="btn" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="videoArea">
      <div class="santaFrame" id="santaFrame">
        <svg class="santaSvg bob" id="santaSvg" viewBox="0 0 320 320" xmlns="http://www.w3.org/2000/svg" aria-label="Santa avatar">
          <defs>
            <linearGradient id="hat" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#C62828"/>
              <stop offset="1" stop-color="#ff7a7a"/>
            </linearGradient>
          </defs>
          <circle cx="160" cy="170" r="110" fill="#ffffff" stroke="#e5e7eb" stroke-width="6"/>
          <path d="M92 118 C120 48, 220 48, 248 118 C210 100, 130 100, 92 118 Z" fill="url(#hat)"/>
          <path d="M240 78 C270 95, 276 124, 252 138 C232 150, 218 126, 240 78 Z" fill="url(#hat)"/>
          <circle cx="255" cy="145" r="16" fill="#ffffff" stroke="#e5e7eb" stroke-width="4"/>
          <rect x="98" y="112" width="124" height="26" rx="13" fill="#ffffff" stroke="#e5e7eb" stroke-width="4"/>
          <circle cx="160" cy="175" r="78" fill="#ffe0c2" stroke="#f1c7a2" stroke-width="3"/>
          <circle cx="132" cy="170" r="7" fill="#0b1220"/>
          <circle cx="188" cy="170" r="7" fill="#0b1220"/>
          <circle cx="160" cy="188" r="10" fill="#f7b7a6" stroke="#f1a796" stroke-width="2"/>
          <g class="mouth" transform-origin="160px 212px">
            <path d="M138 212 C150 228, 170 228, 182 212" fill="none" stroke="#0b1220" stroke-width="6" stroke-linecap="round"/>
          </g>
          <g class="beard" transform-origin="160px 228px">
            <path d="M104 210 C98 260, 128 292, 160 292 C192 292, 222 260, 216 210
                     C206 250, 190 262, 160 262 C130 262, 114 250, 104 210 Z"
                  fill="#ffffff" stroke="#e5e7eb" stroke-width="6"/>
          </g>
        </svg>
        <div class="label">Santa</div>
      </div>

      <video id="selfPreview" muted playsinline></video>
      <div class="selfLabel" id="selfLabel">You</div>
    </div>

    <div class="controls">
      <button class="btn good" id="callBtn">Call</button>
      <button class="btn" id="storyBtn">Story</button>
      <button class="btn" id="gameBtn">Game</button>
      <button class="btn primary" id="sayBtn">Say (typed)</button>
      <button class="btn warn" id="hangupBtn" disabled>Hang up</button>
    </div>
  </section>

  <aside class="stack">
    <div class="card">
      <p class="title">Transcript (optional)</p>
      <p class="sub">Realtime audio comes via WebRTC. Text transcript comes via the WebRTC data channel events.</p>
      <div class="log" id="log"></div>
      <div style="height:10px"></div>
      <input id="typed" placeholder="Type something (fallback)..."/>
      <div class="small" style="margin-top:10px">
        Tip: The kid can just talk. Santa will respond automatically when VAD detects a pause.
      </div>
    </div>

    <div class="card">
      <p class="title">Kid-appropriate tuning (4–6)</p>
      <p class="sub">
        Santa gives clear choices, repeats options, offers clues, and celebrates effort. Story mode is long-form, 5–10 minutes, and uses the child’s prompts.
      </p>
      <div class="choiceRow">
        <span class="pill" id="vadPill">VAD: On</span>
        <span class="pill" id="connPill">WebRTC: Idle</span>
      </div>
    </div>

    <div class="card">
      <p class="title">Setup</p>
      <p class="sub">Run the backend then open this page from http://localhost:8792</p>
      <p class="sub" style="margin-top:8px;">Backend uses the OpenAI Realtime WebRTC “unified interface” endpoint.</p>
    </div>
  </aside>
</main>

<script src="./app.js"></script>
</body>
</html>
